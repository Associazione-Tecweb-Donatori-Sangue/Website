<!DOCTYPE html>
<html lang="it">
    <head>
        <title>Profilo Admin - ATDS</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="Pagina per visualizzare il profilo dell'admin dell'Associazione Tecweb Donatori Sangue">
        <meta name="keywords" content="profilo, admin, associazione, sangue, ATDS">
        <meta name="author" content="ATDS Team">

        <link rel="stylesheet" href="/ggiora/src/css/desktop.css">
        <link rel="stylesheet" href="/ggiora/src/css/mobile.css" media="screen and (max-width:768px)">
        <link rel="stylesheet" href="/ggiora/src/css/print.css" media="print">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Jost&display=swap" rel="stylesheet">

        [FAVICON]
        
        <script src="/ggiora/src/js/script.js"></script>
    </head>
    
    <body class="page-background profile-admin">
        [HEADER]

        <div id="title-standard">
            <h1>Profilo Admin</h1>
            <h2>Ti diamo il benvenuto nell'area gestionale</h2>
        </div>

        <main id="content" class="main-standard">
            <div class="dashboard-container">
            <div class="profile-header">
                <button type="button" class="profile-picture [CLASS_DEFAULT]" 
                    aria-label="Modifica foto profilo dell'utente, premere per modificare"
                    id="profile-picture-btn">
                    <img src="[FOTO_PROFILO]" alt="Foto profilo utente" id="profile-img">                        
                    <input type="file" id="photo-upload" name="foto_profilo" accept="image/jpeg,image/png" aria-hidden="true">
                    <span class="remove-photo" id="remove-photo-btn" role="button" tabindex="0" aria-label="Rimuovi foto profilo">&times;</span>
                </button>
                    <div class="button-container">
                        <a href="/ggiora/src/php/actions/logout.php" class="btn-std btn-profile"><span lang="en">Logout</span></a>
                    </div>
                </div>
            
            <p class="text-standard">Seleziona una delle voci per accedere alle operazioni relative ai donatori, alle donazioni di sangue prenotate e alle statistiche.</p>

            <!-- Tab Navigation -->
            <div class="admin-tabs" role="tablist" aria-label="Sezioni di gestione admin">
                <button role="tab" 
                        aria-selected="false" 
                        aria-controls="panel-utenti" 
                        id="tab-utenti"
                        class="admin-tab">
                    Gestione utenti
                </button>
                <button role="tab" 
                        aria-selected="false" 
                        aria-controls="panel-prenotazioni" 
                        id="tab-prenotazioni"
                        class="admin-tab">
                    Lista prenotazioni
                </button>
                <button role="tab" 
                        aria-selected="false" 
                        aria-controls="panel-statistiche" 
                        id="tab-statistiche"
                        class="admin-tab">
                    Statistiche
                </button>
            </div>

            <!-- Tab Panels -->
            <div id="panel-utenti" role="tabpanel" aria-labelledby="tab-utenti" hidden class="admin-tabpanel">
                <h3 class="tertiary-title-centered">Gestione utenti</h3>

              <div class="admin-controls">
                <label for="filtro-utenti">Filtra per:</label>
                <div class="select-locations-admin">
                    <select id="filtro-utenti">
                        <option value="tutti">Tutti</option>
                        <optgroup label="Donatori">
                            <option value="donatori">Donatori</option>
                        </optgroup>
                        <optgroup label="Sesso">
                            <option value="maschio">Maschio</option>
                            <option value="femmina">Femmina</option>
                        </optgroup>
                        <optgroup label="Gruppo sanguigno">
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="0+">0+</option>
                            <option value="0-">0-</option>
                        </optgroup>
                    </select>
                </div>
            </div>

                <div id="utenti-wrapper">
                    <div class="table-container"></div>
                </div>
            </div>
            <div id="panel-prenotazioni" role="tabpanel" aria-labelledby="tab-prenotazioni" hidden class="admin-tabpanel">
                <h3 class="tertiary-title-centered">Riepilogo donazioni prenotate</h3>
                
                <label for="sede-donazioni">Filtra per sede:</label>
                <div class="select-locations-admin">
                    <select id="sede-donazioni" name="sede-donazioni">
                        <option value="tutte">Tutte le sedi</option>
                        <option value="ATDS Piovego">ATDS Piovego</option>
                        <option value="ATDS Lum250">ATDS Lum250</option>
                        <option value="ATDS Stanga">ATDS Stanga</option>
                        <option value="ATDS Portello">ATDS Portello</option>
                        <option value="ATDS Prato della Valle">ATDS Prato della Valle</option>
                        <option value="ATDS Dietro Stazione">ATDS Dietro Stazione</option>
                        <option value="ATDS del Bo">ATDS del Bo</option>
                        <option value="ATDS Specola">ATDS Specola</option>
                    </select>
                </div>

                <div id="prenotazioni-wrapper">
                    <div class="table-container">
                    </div>
                </div>
            </div>

            <div id="panel-statistiche" role="tabpanel" aria-labelledby="tab-statistiche" hidden class="admin-tabpanel">
                <h3 class="tertiary-title-centered">Statistiche dell'Associazione</h3>
                
                <div class="stats-grid">
                    <!-- Card 1: Donazioni Mese -->
                    <div class="stat-card">
                        <h4>Donazioni questo mese</h4>
                        <div class="stat-value" id="stat-donazioni-mese">-</div>
                        <p class="stat-trend">Dati aggiornati in tempo reale</p>
                    </div>

                    <!-- Card 2: Donazioni Totali -->
                    <div class="stat-card">
                        <h4>Donazioni totali</h4>
                        <div class="stat-value" id="stat-donazioni-totali">-</div>
                        <p class="stat-trend">Dalla fondazione dell'associazione</p>
                    </div>

                    <!-- Card 3: Sede più frequentata -->
                    <div class="stat-card">
                        <h4>Sede più frequentata</h4>
                        <div class="stat-value" id="stat-sede-nome">-</div>
                        <p class="stat-sub"><span id="stat-sede-count">0</span> prenotazioni totali</p>
                    </div>

                    <!-- Card 4: Orario più frequentato -->
                    <div class="stat-card">
                        <h4>Orario più frequentato</h4>
                        <div class="stat-value" id="stat-orario-top">-</div>
                        <p class="stat-sub"><span id="stat-orario-count">0</span> prenotazioni in questo orario</p>
                    </div>

                    <!-- Card 5: Gruppi Sanguigni (occupa tutta la larghezza) -->
                    <div class="stat-card full-width">
                        <h4>Distribuzione Gruppi Sanguigni</h4>
                        <div class="chart-container" id="stat-chart-container">
                            <p>Caricamento dati...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Dialog per conferma rimozione foto profilo -->
        <dialog id="deletePhotoDialog" aria-labelledby="dialogTitle" aria-describedby="dialogDesc" aria-modal="true">
            <div class="dialog-content">
                <h2 id="dialogTitle">Rimozione foto profilo</h2>
                <p id="dialogDesc">Sei sicuro di voler rimuovere la tua foto profilo?</p>

                <div class="dialog-buttons">
                <button type="button" class="btn-delete" id="confirmDeleteBtn">Rimuovi</button>
                <button type="button" class="btn-std" id="cancelDeleteBtn">Annulla</button>
                </div>
            </div>
        </dialog>

        <!-- Dialog per formato file non valido -->
        <dialog id="invalidFormatDialog" role="alertdialog" aria-labelledby="invalidFormatTitle" aria-describedby="invalidFormatDesc" aria-modal="true">
            <div class="dialog-content">
                <h2 id="invalidFormatTitle">Formato non valido</h2>
                <p id="invalidFormatDesc">Sono consentiti solo file <span lang="en">JPG</span> o <span lang="en">PNG</span>.</p>

                <div class="dialog-buttons">
                <button type="button" class="btn-std" id="closeInvalidFormatBtn">Chiudi</button>
                </div>
            </div>
        </dialog>

        <!-- Dialog per conferma eliminazione prenotazione -->
        <dialog id="dialog-elimina-prenotazione-admin" aria-labelledby="dialog-elimina-title" aria-describedby="dialog-elimina-desc" aria-modal="true">
            <div class="dialog-content">
                <h2 id="dialog-elimina-title">Conferma eliminazione</h2>
                <p id="dialog-elimina-desc">Sei sicuro di voler eliminare la prenotazione di <span id="elimina-username"></span> del <span id="elimina-data"></span> alle ore <span id="elimina-ora"></span>?</p>
                <div class="dialog-buttons">
                    <form action="../actions/cancellaPrenotazione.php" method="POST" class="dialog-form" id="form-elimina-prenotazione-admin">
                        <input type="hidden" name="id_prenotazione" id="hidden-id-prenotazione-admin" value="">
                        <button type="submit" class="btn-delete">Elimina prenotazione</button>
                    </form>
                    <button type="button" id="btn-annulla-elimina-admin" class="btn-std">Annulla</button>
                </div>
            </div>
        </dialog>

        <!-- Dialog per file troppo pesante -->
        <dialog id="fileTooLargeDialog" role="alertdialog" aria-labelledby="fileTooLargeTitle" aria-describedby="fileTooLargeDesc" aria-modal="true">
            <div class="dialog-content">
                <h2 id="fileTooLargeTitle"><span lang="en">File</span> troppo grande</h2>
                <p id="fileTooLargeDesc">Il <span lang="en">file</span> selezionato supera la dimensione massima consentita di 5<abbr lang="en" title="Megabyte">MB</abbr>.</p>

                <div class="dialog-buttons">
                    <button type="button" class="btn-std" id="closeFileTooLargeBtn">Chiudi</button>
                </div>
            </div>
        </dialog>

           <!-- Dialog generico per errori upload -->
        <dialog id="uploadErrorDialog" role="alertdialog" aria-labelledby="uploadErrorTitle" aria-describedby="uploadErrorDesc" aria-modal="true">
            <div class="dialog-content">
                <h2 id="uploadErrorTitle">Errore caricamento</h2>
                <p id="uploadErrorDesc">Si è verificato un errore durante il caricamento della foto.</p>

                <div class="dialog-buttons">
                    <button type="button" class="btn-std" id="closeUploadErrorBtn">Chiudi</button>
                </div>
            </div>
        </dialog>

        <!-- Dialog per conferma eliminazione utente -->
        <dialog id="dialog-elimina-utente" aria-labelledby="dialog-elimina-utente-title" aria-describedby="dialog-elimina-utente-desc" aria-modal="true">
            <div class="dialog-content">
                <h2 id="dialog-elimina-utente-title">Conferma eliminazione utente</h2>
                <p id="dialog-elimina-utente-desc">Sei sicuro di voler eliminare l'utente <span id="elimina-utente-username"></span>? Questa azione è irreversibile.</p>
                <div class="dialog-buttons">
                    <form action="../actions/cancellaUtente.php" method="POST" class="dialog-form" id="form-elimina-utente">
                        <input type="hidden" name="id_utente" id="hidden-id-utente" value="">
                        <button type="submit" class="btn-delete">Elimina utente</button>
                    </form>
                    <button type="button" id="btn-annulla-elimina-utente" class="btn-std">Annulla</button>
                </div>
            </div>
        </dialog>
        
        [FOOTER]
    </body>
</html>
